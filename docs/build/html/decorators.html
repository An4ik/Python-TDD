

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Decorators &mdash; Python-TDD 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Context manager" href="context_manager.html" />
    <link rel="prev" title="Fibonacci numbers" href="fibonacci_numbers.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Python-TDD
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Hello Python, Hi TDD!</a></li>
<li class="toctree-l1"><a class="reference internal" href="baby_steps.html">Baby steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="magic_functions.html">Magic functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="fibonacci_numbers.html">Fibonacci numbers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Decorators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-you-need-to-know-about-functions">What you need to know about functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#assign-functions-to-variables">Assign functions to variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-functions-inside-other-functions">Define functions inside other functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions-can-return-other-functions">Functions can return other functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inner-functions-have-access-to-the-enclosing-scope">Inner functions have access to the enclosing scope</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stringify">Stringify</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-s-decorator-syntax">Python’s Decorator Syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#composition-of-decorators">Composition of Decorators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-decorated-functions">Debugging decorated functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#registration">Registration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="context_manager.html">Context manager</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python-TDD</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Decorators</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/decorators.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="decorators">
<h1>Decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">¶</a></h1>
<p>Decorator - dynamically alter the functionality of a function, method, or class
without having to directly use subclasses or change the source code of the
function being decorated.</p>
<dl class="docutils">
<dt><strong>ToDo:</strong></dt>
<dd><ol class="first last arabic simple">
<li>Research &amp; Read about functions and decorators.</li>
<li>Implement simple decorator.</li>
<li>Implement decorator with arguments.</li>
</ol>
</dd>
</dl>
<p><strong>Learn:</strong> Decorator.</p>
<p><strong>Working directory:</strong>  <a class="reference external" href="https://github.com/An4ik/Python-TDD/tree/master/decorator">**decorator**</a></p>
<div class="section" id="what-you-need-to-know-about-functions">
<h2>What you need to know about functions<a class="headerlink" href="#what-you-need-to-know-about-functions" title="Permalink to this headline">¶</a></h2>
<p>Before diving in, there are some prerequisites that should be clear.
In Python, functions are first class citizens, they are objects and
that means we can do a lot of useful stuff with them.</p>
<div class="section" id="assign-functions-to-variables">
<h3>Assign functions to variables<a class="headerlink" href="#assign-functions-to-variables" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;hello &quot;</span> <span class="o">+</span> <span class="n">name</span>

<span class="n">greet_someone</span> <span class="o">=</span> <span class="n">greet</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">greet_someone</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">))</span>

<span class="c1"># Outputs: hello John</span>
</pre></div>
</div>
</div>
<div class="section" id="define-functions-inside-other-functions">
<h3>Define functions inside other functions<a class="headerlink" href="#define-functions-inside-other-functions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_message</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;Hello &quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">get_message</span><span class="p">()</span> <span class="o">+</span> <span class="n">name</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">greet</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">))</span>
<span class="c1"># Outputs: Hello John</span>
</pre></div>
</div>
</div>
<div class="section" id="functions-can-return-other-functions">
<h3>Functions can return other functions<a class="headerlink" href="#functions-can-return-other-functions" title="Permalink to this headline">¶</a></h3>
<p>In other words, functions generating other functions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compose_greet_func</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">get_message</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;Hello there!&quot;</span>
    <span class="k">return</span> <span class="n">get_message</span>

<span class="n">greet</span> <span class="o">=</span> <span class="n">compose_greet_func</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">greet</span><span class="p">())</span>
<span class="c1"># Outputs: Hello there!</span>
</pre></div>
</div>
</div>
<div class="section" id="inner-functions-have-access-to-the-enclosing-scope">
<h3>Inner functions have access to the enclosing scope<a class="headerlink" href="#inner-functions-have-access-to-the-enclosing-scope" title="Permalink to this headline">¶</a></h3>
<p>More commonly known as a closure. A very powerful pattern that we will come
across while building decorators. Another thing to note, Python only allows
read access to the outer scope and not assignment. Notice how we modified
the example above to read a “name” argument from the enclosing scope of the
inner function and return the new function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compose_greet_func</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">get_message</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;Hello there!&quot;</span>
    <span class="k">return</span> <span class="n">get_message</span>

<span class="n">greet</span> <span class="o">=</span> <span class="n">compose_greet_func</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">greet</span><span class="p">())</span>
<span class="c1"># Outputs: Hello there!</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="stringify">
<h2>Stringify<a class="headerlink" href="#stringify" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Look at the file <a class="reference external" href="https://github.com/An4ik/Python-TDD/blob/master/decorator/stringify.py/">stringify.py</a></p>
</li>
<li><p class="first">Run tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">tests</span><span class="o">/</span><span class="n">test_stringify</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># Runs 4 tests and all of them are FAILED (failures=4)</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic simple" start="4">
<li>Now, complete the first failed function in <strong>stringify.py</strong>.</li>
<li>Run the tests <em>(step 3)</em> and make sure you have +1 passed test.</li>
<li>Repeat the steps <em>4 and 5</em> until all of them are passed.</li>
<li>Compare your answer with mine located in <strong>answers/stringify.py</strong></li>
</ol>
<p>You can commit your changes</p>
</div>
<div class="section" id="python-s-decorator-syntax">
<h2>Python’s Decorator Syntax<a class="headerlink" href="#python-s-decorator-syntax" title="Permalink to this headline">¶</a></h2>
<p>Python makes creating and using decorators a bit cleaner and nicer for
the programmer through some syntactic sugar To decorate get_text we don’t
have to get_text = p_decorator(get_text) There is a neat shortcut for that,
which is to mention the name of the decorating function before the function
to be decorated. The name of the decorator should be perpended with an &#64; symbol.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">p_decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;p&gt;</span><span class="si">{0}</span><span class="s2">&lt;/p&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">func_wrapper</span>

<span class="nd">@p_decorate</span>
<span class="k">def</span> <span class="nf">get_text</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
   <span class="k">return</span> <span class="s2">&quot;lorem ipsum, </span><span class="si">{0}</span><span class="s2"> dolor sit amet&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">))</span>
<span class="c1"># Outputs &lt;p&gt;lorem ipsum, John dolor sit amet&lt;/p&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="composition-of-decorators">
<h3>Composition of Decorators<a class="headerlink" href="#composition-of-decorators" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">p_decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
       <span class="k">return</span> <span class="s2">&quot;&lt;p&gt;</span><span class="si">{0}</span><span class="s2">&lt;/p&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">func_wrapper</span>

<span class="k">def</span> <span class="nf">strong_decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;strong&gt;</span><span class="si">{0}</span><span class="s2">&lt;/strong&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">func_wrapper</span>

<span class="k">def</span> <span class="nf">div_decorate</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;div&gt;</span><span class="si">{0}</span><span class="s2">&lt;/div&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">func_wrapper</span>

<span class="n">get_text</span> <span class="o">=</span> <span class="n">div_decorate</span><span class="p">(</span><span class="n">p_decorate</span><span class="p">(</span><span class="n">strong_decorate</span><span class="p">(</span><span class="n">get_text</span><span class="p">)))</span>
<span class="nb">print</span> <span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">)</span>

<span class="c1"># Or pythonic approach</span>
<span class="nd">@div_decorate</span>
<span class="nd">@p_decorate</span>
<span class="nd">@strong_decorate</span>
<span class="k">def</span> <span class="nf">get_text</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
   <span class="k">return</span> <span class="s2">&quot;lorem ipsum, </span><span class="si">{0}</span><span class="s2"> dolor sit amet&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">get_text</span><span class="p">(</span><span class="s2">&quot;John&quot;</span><span class="p">)</span>
<span class="c1"># Both output &lt;div&gt;&lt;p&gt;&lt;strong&gt;lorem ipsum, John dolor sit amet&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="debugging-decorated-functions">
<h3>Debugging decorated functions<a class="headerlink" href="#debugging-decorated-functions" title="Permalink to this headline">¶</a></h3>
<p>At the end of the day decorators are just wrapping our functions, in case of
debugging that can be problematic since the wrapper function does not carry
the name, module and docstring of the original function. Based on the example
above if we do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">get_text</span><span class="o">.</span><span class="vm">__name__</span>
<span class="c1"># Outputs func_wrapper</span>
</pre></div>
</div>
<p>The output was expected to be get_text yet, the attributes __name__, __doc__,
and __module__ of get_text got overridden by those of the wrapper(func_wrapper).
Obviously we can reset them within func_wrapper but Python provides a much nicer way.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="n">tag_name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">tags_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{0}</span><span class="s2">&gt;</span><span class="si">{1}</span><span class="s2">&lt;/</span><span class="si">{0}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">func_wrapper</span>
    <span class="k">return</span> <span class="n">tags_decorator</span>

<span class="nd">@tags</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_text</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns some text&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;Hello &quot;</span><span class="o">+</span><span class="n">name</span>

<span class="nb">print</span> <span class="n">get_text</span><span class="o">.</span><span class="vm">__name__</span> <span class="c1"># get_text</span>
<span class="nb">print</span> <span class="n">get_text</span><span class="o">.</span><span class="vm">__doc__</span> <span class="c1"># returns some text</span>
<span class="nb">print</span> <span class="n">get_text</span><span class="o">.</span><span class="vm">__module__</span> <span class="c1"># __main__</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="registration">
<h2>Registration<a class="headerlink" href="#registration" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Look at the file <a class="reference external" href="https://github.com/An4ik/Python-TDD/blob/master/decorator/registration.py/">registration.py</a></p>
</li>
<li><p class="first">Run tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">tests</span><span class="o">/</span><span class="n">test_registration</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># Runs 4 tests and all of them are FAILED (failures=4)</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic simple" start="4">
<li>Now, complete the first failed function in <strong>registration.py</strong>.</li>
<li>Run the tests <em>(step 3)</em> and make sure you have +1 passed test.</li>
<li>Repeat the steps <em>4 and 5</em> until all of them are passed.</li>
<li>Compare your answer with mine located in <strong>answers/registration.py</strong></li>
</ol>
<p>You can commit your changes</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="context_manager.html" class="btn btn-neutral float-right" title="Context manager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fibonacci_numbers.html" class="btn btn-neutral" title="Fibonacci numbers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Akhmetov Anuar

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>